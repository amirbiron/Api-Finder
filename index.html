<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>בוט זיהוי API</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* RTL fixes for Tailwind */
        [dir="rtl"] .text-right { text-align: right; }
        [dir="rtl"] .mr-2 { margin-left: 0.5rem; margin-right: 0; }
        [dir="rtl"] .ml-2 { margin-right: 0.5rem; margin-left: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide Icons as SVG components
        const Search = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="21 21l-4.35-4.35"></path>
            </svg>
        );

        const Globe = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="2" y1="12" x2="22" y2="12"></line>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
            </svg>
        );

        const Loader2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="animate-spin">
                <path d="M21 12a9 9 0 11-6.219-8.56"></path>
            </svg>
        );

        const AlertCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const CheckCircle = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22,4 12,14.01 9,11.01"></polyline>
            </svg>
        );

        const Code = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="16,18 22,12 16,6"></polyline>
                <polyline points="8,6 2,12 8,18"></polyline>
            </svg>
        );

        const FileText = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14,2 14,8 20,8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10,9 9,9 8,9"></polyline>
            </svg>
        );

        const Copy = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
        );

        const RotateCcw = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="1,4 1,10 7,10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        // פונקציה לניתוח מקומי של אתרים
        const analyzeWebsiteLocally = (url, domain, websiteContent) => {
            // מאגר מידע על שירותים נפוצים
            const knownServices = {
                'github.com': {
                    serviceName: 'GitHub',
                    hasAPI: true,
                    apiType: 'REST',
                    baseURL: 'https://api.github.com',
                    documentationURL: 'https://docs.github.com/en/rest',
                    requiresAuth: true,
                    authType: 'Personal Access Token',
                    keyEndpoints: ['/user', '/repos', '/issues', '/pulls', '/search/repositories'],
                    description: 'פלטפורמת פיתוח וניהול קוד מקור',
                    exampleRequest: 'curl -H "Authorization: token YOUR_TOKEN" https://api.github.com/user',
                    sdkAvailable: true,
                    rateLimits: '5000 בקשות לשעה למשתמשים מאומתים',
                    pricingModel: 'חינמי עם מגבלות, תוכניות בתשלום'
                },
                'api.openai.com': {
                    serviceName: 'OpenAI',
                    hasAPI: true,
                    apiType: 'REST',
                    baseURL: 'https://api.openai.com/v1',
                    documentationURL: 'https://platform.openai.com/docs',
                    requiresAuth: true,
                    authType: 'API Key',
                    keyEndpoints: ['/chat/completions', '/completions', '/images/generations', '/audio/transcriptions', '/models'],
                    description: 'שירותי בינה מלאכותית ומודלי שפה',
                    exampleRequest: 'curl -H "Authorization: Bearer YOUR_API_KEY" -H "Content-Type: application/json" -d \'{"model":"gpt-3.5-turbo","messages":[{"role":"user","content":"Hello!"}]}\' https://api.openai.com/v1/chat/completions',
                    sdkAvailable: true,
                    rateLimits: 'משתנה לפי תוכנית התשלום',
                    pricingModel: 'תשלום לפי שימוש'
                },
                'api.anthropic.com': {
                    serviceName: 'Anthropic Claude',
                    hasAPI: true,
                    apiType: 'REST',
                    baseURL: 'https://api.anthropic.com/v1',
                    documentationURL: 'https://docs.anthropic.com',
                    requiresAuth: true,
                    authType: 'API Key',
                    keyEndpoints: ['/messages', '/models'],
                    description: 'שירותי בינה מלאכותית ומודל Claude',
                    exampleRequest: 'curl -H "x-api-key: YOUR_API_KEY" -H "Content-Type: application/json" -d \'{"model":"claude-3-sonnet-20240229","max_tokens":1000,"messages":[{"role":"user","content":"Hello"}]}\' https://api.anthropic.com/v1/messages',
                    sdkAvailable: true,
                    rateLimits: 'משתנה לפי תוכנית התשלום',
                    pricingModel: 'תשלום לפי שימוש'
                },
                'jsonplaceholder.typicode.com': {
                    serviceName: 'JSONPlaceholder',
                    hasAPI: true,
                    apiType: 'REST',
                    baseURL: 'https://jsonplaceholder.typicode.com',
                    documentationURL: 'https://jsonplaceholder.typicode.com',
                    requiresAuth: false,
                    authType: null,
                    keyEndpoints: ['/posts', '/comments', '/albums', '/photos', '/todos', '/users'],
                    description: 'API דמה לבדיקות ופרוטוטיפים',
                    exampleRequest: 'curl https://jsonplaceholder.typicode.com/posts/1',
                    sdkAvailable: false,
                    rateLimits: 'ללא מגבלות',
                    pricingModel: 'חינמי לחלוטין'
                }
            };

            // בדיקה אם השירות ידוע
            if (knownServices[domain]) {
                return knownServices[domain];
            }

            // ניתוח כללי מבוסס על דומיין
            let serviceName = domain.replace(/^(www\.|api\.)/, '').split('.')[0];
            serviceName = serviceName.charAt(0).toUpperCase() + serviceName.slice(1);

            // זיהוי סוג שירות לפי דומיין
            let apiType = 'REST';
            let hasAPI = true;
            let requiresAuth = true;
            let authType = 'API Key';
            let baseURL = `https://api.${domain}`;
            let documentationURL = `https://${domain}/docs`;
            let description = `שירות מבוסס ${serviceName}`;
            let keyEndpoints = ['/api/v1/data', '/api/v1/users', '/api/v1/search'];
            let pricingModel = 'freemium';
            let rateLimits = '1000 בקשות לשעה';
            let sdkAvailable = false;

            // התאמות מיוחדות לפי סוג דומיין
            if (domain.includes('api.')) {
                baseURL = `https://${domain}`;
                description += ' - שירות API ייעודי';
            } else if (domain.includes('github')) {
                return knownServices['github.com'];
            } else if (domain.includes('google')) {
                serviceName = 'Google API';
                baseURL = `https://www.googleapis.com`;
                documentationURL = 'https://developers.google.com';
                authType = 'OAuth 2.0';
                keyEndpoints = ['/v1/search', '/v1/translate', '/v1/maps'];
                description = 'שירותי Google API';
                sdkAvailable = true;
            } else if (domain.includes('facebook') || domain.includes('meta')) {
                serviceName = 'Meta/Facebook API';
                baseURL = 'https://graph.facebook.com';
                documentationURL = 'https://developers.facebook.com';
                authType = 'Access Token';
                keyEndpoints = ['/me', '/posts', '/photos', '/friends'];
                description = 'שירותי Meta ופייסבוק';
                sdkAvailable = true;
            } else if (domain.includes('twitter') || domain.includes('x.com')) {
                serviceName = 'Twitter/X API';
                baseURL = 'https://api.twitter.com/2';
                documentationURL = 'https://developer.twitter.com';
                authType = 'Bearer Token';
                keyEndpoints = ['/tweets', '/users', '/spaces', '/lists'];
                description = 'שירותי Twitter/X';
                sdkAvailable = true;
            } else if (domain.includes('stripe')) {
                serviceName = 'Stripe';
                baseURL = 'https://api.stripe.com/v1';
                documentationURL = 'https://stripe.com/docs/api';
                keyEndpoints = ['/charges', '/customers', '/subscriptions', '/invoices'];
                description = 'שירותי תשלומים מקוונים';
                pricingModel = 'תשלום לפי עמלות';
                sdkAvailable = true;
            } else if (domain.includes('weather')) {
                serviceName = 'Weather API';
                keyEndpoints = ['/current', '/forecast', '/history'];
                description = 'שירותי מזג אוויר';
            } else if (domain.includes('news')) {
                serviceName = 'News API';
                keyEndpoints = ['/headlines', '/everything', '/sources'];
                description = 'שירותי חדשות';
            }

            // בדיקה אם זה אתר רגיל ללא API
            if (domain.includes('wikipedia') || domain.includes('blog') || 
                domain.includes('news') && !domain.includes('api')) {
                hasAPI = false;
                description += ' - אתר תוכן רגיל ללא API ציבורי';
            }

            return {
                serviceName,
                hasAPI,
                apiType,
                baseURL: hasAPI ? baseURL : null,
                documentationURL: hasAPI ? documentationURL : null,
                requiresAuth: hasAPI ? requiresAuth : false,
                authType: hasAPI && requiresAuth ? authType : null,
                keyEndpoints: hasAPI ? keyEndpoints : [],
                description,
                exampleRequest: hasAPI ? `curl -H "Authorization: Bearer YOUR_TOKEN" ${baseURL}${keyEndpoints[0] || '/api/v1/data'}` : null,
                sdkAvailable,
                rateLimits: hasAPI ? rateLimits : null,
                pricingModel: hasAPI ? pricingModel : null
            };
        };

        const APIDetectorBot = () => {
            const [url, setUrl] = useState('');
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [error, setError] = useState('');

            const copyResults = () => {
                if (result) {
                    const textToCopy = JSON.stringify(result, null, 2);
                    navigator.clipboard.writeText(textToCopy);
                    alert('התוצאות הועתקו ללוח!');
                }
            };

            const resetForm = () => {
                setResult(null);
                setError('');
                setUrl('');
            };

            const analyzeAPI = async () => {
                if (!url.trim()) {
                    setError('נא להזין URL תקין');
                    return;
                }

                setLoading(true);
                setError('');
                setResult(null);

                try {
                    const domain = new URL(url).hostname;
                    
                    // שלב 1: קבלת תוכן האתר דרך CORS proxy
                    let websiteContent = '';
                    try {
                        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
                        const siteResponse = await fetch(proxyUrl);
                        if (siteResponse.ok) {
                            const html = await siteResponse.text();
                            // חילוץ טקסט רלוונטי מה-HTML
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, 'text/html');
                            
                            // חיפוש מילות מפתח API רלוונטיות
                            const textContent = doc.body?.textContent || '';
                            const apiKeywords = ['api', 'developer', 'documentation', 'endpoint', 'REST', 'GraphQL', 'token', 'key'];
                            const relevantSentences = textContent.split('.').filter(sentence => 
                                apiKeywords.some(keyword => sentence.toLowerCase().includes(keyword))
                            ).slice(0, 10).join('. ');
                            
                            websiteContent = relevantSentences;
                        }
                    } catch (proxyError) {
                        console.log('לא ניתן לקרוא את האתר ישירות, ממשיך ללא תוכן');
                    }
                    
                    // שלב 2: ניתוח מקומי מבוסס על כללים (במקום API חיצוני)
                    // מכיוון שאין גישה ל-API של Claude, נשתמש בניתוח מקומי חכם
                    const apiInfo = analyzeWebsiteLocally(url, domain, websiteContent);
                    setResult(apiInfo);
                    
                } catch (err) {
                    setError(`שגיאה: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const generateCodeExample = (result) => {
                if (!result?.baseURL || !result?.keyEndpoints?.length) return '';
                
                const endpoint = result.keyEndpoints[0];
                const authHeader = result.requiresAuth ? 
                    (result.authType === 'API Key' ? `'Authorization': 'Bearer YOUR_API_KEY'` : `'Authorization': 'Bearer YOUR_TOKEN'`) : '';
                
                return `// דוגמה לשימוש ב-JavaScript
fetch('${result.baseURL}${endpoint}', {
  method: 'GET',
  headers: {
    'Content-Type': 'application/json',${authHeader ? '\n    ' + authHeader : ''}
  }
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-3 sm:p-6" dir="rtl">
                    <div className="max-w-4xl mx-auto">
                        <div className="text-center mb-6 sm:mb-8">
                            <h1 className="text-3xl sm:text-4xl font-bold text-gray-800 mb-4">
                                🤖 בוט זיהוי API
                            </h1>
                            <p className="text-base sm:text-lg text-gray-600 mb-4">
                                גלה מידע טכני על כל API תוך שניות עם בינה מלאכותית מתקדמת
                            </p>
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4 max-w-2xl mx-auto">
                                <p className="text-blue-800 text-xs sm:text-sm">
                                    💡 <strong>טיפ:</strong> הזן כתובת של אתר או שירות ותקבל ניתוח מפורט של ה-API שלו - endpoints, authentication, דוקומנטציה ועוד
                                </p>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl shadow-lg p-4 sm:p-8 mb-6">
                            <div className="space-y-6">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        <Globe className="inline w-4 h-4 mr-2" />
                                        URL של האתר או השירות
                                    </label>
                                    <div className="flex flex-col sm:flex-row gap-3">
                                        <input
                                            type="url"
                                            value={url}
                                            onChange={(e) => setUrl(e.target.value)}
                                            className="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                            placeholder="https://api.example.com"
                                            onKeyPress={(e) => e.key === 'Enter' && analyzeAPI()}
                                        />
                                        <button
                                            onClick={analyzeAPI}
                                            disabled={loading}
                                            className="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                        >
                                            {loading ? (
                                                <Loader2 />
                                            ) : (
                                                <Search />
                                            )}
                                            נתח
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {error && (
                            <div className="bg-red-50 border border-red-200 rounded-lg p-3 sm:p-4 mb-6">
                                <div className="flex items-center gap-2 text-red-800">
                                    <AlertCircle />
                                    <span className="text-sm break-words">{error}</span>
                                </div>
                            </div>
                        )}

                        {result && (
                            <div className="bg-white rounded-xl shadow-lg p-4 sm:p-8 border border-gray-100">
                                <div className="flex items-center gap-3 mb-6 pb-4 border-b border-gray-100">
                                    <CheckCircle className="text-green-500 flex-shrink-0" />
                                    <div>
                                        <h2 className="text-xl sm:text-2xl font-bold text-gray-800">
                                            {result.serviceName || 'שירות זוהה'}
                                        </h2>
                                        <p className="text-gray-500 text-xs sm:text-sm mt-1">
                                            ✨ ניתוח API הושלם • {result.hasAPI ? 'API זוהה' : 'לא נמצא API'} • 
                                            קורא את המידע כדי להתחיל לעבוד עם השירות
                                        </p>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                                    <div className="space-y-4">
                                        <div className="bg-gray-50 rounded-lg p-3 sm:p-4">
                                            <h3 className="font-semibold text-gray-700 mb-2 text-sm sm:text-base">📋 פרטי כלליים</h3>
                                            <div className="space-y-2 text-xs sm:text-sm">
                                                <div><strong>יש API:</strong> {result.hasAPI ? '✅ כן' : '❌ לא'}</div>
                                                {result.apiType && <div><strong>📡 סוג API:</strong> {result.apiType}</div>}
                                                {result.description && <div><strong>📝 תיאור:</strong> <span className="break-words">{result.description}</span></div>}
                                                {result.pricingModel && <div><strong>💰 תמחור:</strong> <span className="break-words">{result.pricingModel}</span></div>}
                                            </div>
                                        </div>

                                        <div className="bg-gray-50 rounded-lg p-3 sm:p-4">
                                            <h3 className="font-semibold text-gray-700 mb-2 text-sm sm:text-base">🔐 Authentication</h3>
                                            <div className="space-y-2 text-xs sm:text-sm">
                                                <div><strong>נדרש אימות:</strong> {result.requiresAuth ? '✅ כן' : '❌ לא'}</div>
                                                {result.authType && <div><strong>🔑 סוג אימות:</strong> {result.authType}</div>}
                                                {result.rateLimits && <div><strong>⏱️ מגבלות:</strong> <span className="break-words">{result.rateLimits}</span></div>}
                                            </div>
                                        </div>
                                    </div>

                                    <div className="space-y-4">
                                        {result.baseURL && (
                                            <div className="bg-blue-50 rounded-lg p-3 sm:p-4">
                                                <h3 className="font-semibold text-gray-700 mb-2 text-sm sm:text-base">🌐 כתובות</h3>
                                                <div className="space-y-2 text-xs sm:text-sm">
                                                    <div><strong>🌐 Base URL:</strong> 
                                                        <code className="block bg-white p-2 mt-1 rounded text-xs break-all font-mono text-blue-600 overflow-x-auto">
                                                            {result.baseURL}
                                                        </code>
                                                    </div>
                                                    {result.documentationURL && (
                                                        <div><strong>📚 דוקומנטציה:</strong> 
                                                            <a href={result.documentationURL} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline block mt-1 break-all text-xs">
                                                                🔗 {result.documentationURL}
                                                            </a>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        )}

                                        {result.keyEndpoints && result.keyEndpoints.length > 0 && (
                                            <div className="bg-green-50 rounded-lg p-3 sm:p-4">
                                                <h3 className="font-semibold text-gray-700 mb-2 text-sm sm:text-base">🔗 Endpoints עיקריים</h3>
                                                <div className="space-y-2">
                                                    {result.keyEndpoints.slice(0, 5).map((endpoint, index) => (
                                                        <div key={index} className="bg-white p-2 sm:p-3 rounded border border-green-200">
                                                            <code className="font-mono text-xs sm:text-sm text-green-700 block break-all">
                                                                GET {result.baseURL || ''}{endpoint}
                                                            </code>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {result.baseURL && result.keyEndpoints && result.keyEndpoints.length > 0 && (
                                    <div className="mt-6 bg-gray-900 rounded-lg p-3 sm:p-4">
                                        <h3 className="font-semibold text-white mb-3 flex items-center gap-2 text-sm sm:text-base">
                                            <Code />
                                            💻 דוגמת קוד JavaScript
                                        </h3>
                                        <pre className="bg-gray-800 text-green-400 p-3 sm:p-4 rounded-lg text-xs sm:text-sm overflow-x-auto border border-gray-700">
                                            <code className="whitespace-pre-wrap break-words">{generateCodeExample(result)}</code>
                                        </pre>
                                        {result.exampleRequest && (
                                            <div className="mt-3">
                                                <h4 className="text-white text-xs sm:text-sm font-medium mb-2">🛠️ דוגמת cURL:</h4>
                                                <pre className="bg-gray-800 text-yellow-400 p-2 sm:p-3 rounded text-xs overflow-x-auto border border-gray-700">
                                                    <code className="whitespace-pre-wrap break-words">{result.exampleRequest}</code>
                                                </pre>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {result.sdkAvailable && (
                                    <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3 sm:p-4">
                                        <div className="flex items-center gap-2 text-blue-800">
                                            <FileText className="flex-shrink-0" />
                                            <span className="font-medium text-sm sm:text-base">📦 SDK זמין עבור שירות זה</span>
                                        </div>
                                        <p className="text-blue-700 text-xs sm:text-sm mt-1">ניתן למצוא ספריות רשמיות ב-GitHub או באתר המפתחים של השירות</p>
                                    </div>
                                )}

                                <div className="mt-6 pt-4 border-t border-gray-100 flex flex-col sm:flex-row gap-3 justify-center">
                                    <button
                                        onClick={copyResults}
                                        className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 flex items-center justify-center gap-2 text-sm"
                                    >
                                        <Copy />
                                        העתק תוצאות
                                    </button>
                                    <button
                                        onClick={resetForm}
                                        className="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 flex items-center justify-center gap-2 text-sm"
                                    >
                                        <RotateCcw />
                                        נתח אתר אחר
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="mt-6 sm:mt-8 text-center text-gray-500 text-xs sm:text-sm">
                            <p>מופעל על ידי Claude | נבנה עבור מפתחים ישראליים 🇮🇱</p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<APIDetectorBot />, document.getElementById('root'));
    </script>
</body>
</html>
